var wsuContentVisibility=wsuContentVisibility||{};!function(a,b,c,d,e){"use strict";e.groupView=b.View.extend({template:d.template(c("#visibility-group-template").html()),render:function(){return this.$el.html(this.template(this.model.attributes)),this}})}(window,Backbone,jQuery,_,wsuContentVisibility);var wsuContentVisibility=wsuContentVisibility||{};!function(a,b,c,d,e){"use strict";e.appView=b.View.extend({el:"#wsuwp-content-visibility-box",events:{"click #manage-visibility-groups":"openGroupModal","click #visibility-group-search":"searchGroups","click #visibility-save-groups":"saveGroups","click #visibility-cancel-groups":"cancelGroupSearch","click .visibility-group-overlay-close":"closeGroups","click .visibility-group-single":"toggleMemberList","click .visibility-group-select":"toggleGroupSelection","keydown #visibility-search-term":"searchGroups"},groups:[],groups_modified:[],initialize:function(){this.groups=c.map(a.wsuContentVisibilityGroups,function(a){return a}),this.groups_modified=this.groups},addOne:function(a,b){var d;d=new e.groupView({model:a}),c("#visibility-"+b+"-group-list").find(".visibility-group-results").append(d.render().el)},openGroupModal:function(){this.getCurrentGroups(),this.toggleOverlay()},getCurrentGroups:function(){var a,b={action:"get_content_visibility_groups",_ajax_nonce:wsuContentVisibilityGroups_nonce,post_id:c("#post_ID").val()};c.post(ajaxurl,b,function(b){if(b.success===!1);else{var d=[];a=b.data,c(a).each(function(b){var c=new e.group({groupID:a[b].id,groupName:a[b].display_name,memberCount:a[b].member_count,memberList:a[b].member_list,selectedClass:a[b].selected_class});d.push(a[b].id),e.app.addOne(c,"current")}),this.groups=d}})},removeSearchSpinner:function(){var a=c(".visibility-group-results");a.hasClass("pending-results")&&a.removeClass("pending-results")},showSearchSpinner:function(){var a=c(".visibility-group-results");!1===a.hasClass("pending-results")&&a.addClass("pending-results")},searchGroups:function(a){if("keydown"===a.type&&13===a.keyCode)a.preventDefault(),a.stopPropagation();else if("keydown"===a.type)return!0;this.showSearchSpinner(),this.showSearchList();var b,d={action:"search_content_visibility_groups",_ajax_nonce:wsuContentVisibilityGroups_nonce,post_id:c("#post_ID").val(),visibility_group:c("#visibility-search-term").val()};c.post(ajaxurl,d,function(a){e.app.removeSearchSpinner(),a.success===!1?c(".visibility-group-results").html('<div class="no-group-results">Error: '+a.data+"</div>"):(b=a.data,0===b.length?c(".visibility-group-results").html('<div class="no-group-results">No matching results...</div>'):c(b).each(function(a){var c=new e.group({groupID:b[a].id,groupName:b[a].display_name,memberCount:b[a].member_count,memberList:b[a].member_list,selectedClass:b[a].selected_class});e.app.addOne(c,"find")}))})},cancelGroupSearch:function(){this.groups_modified=this.groups,this.clearCurrentList(),this.getCurrentGroups(),this.showCurrentList(),this.clearSearchList(),this.$("#visibility-search-term").val("")},saveGroups:function(){var a={action:"set_content_visibility_groups",_ajax_nonce:wsuContentVisibilityGroups_nonce,post_id:c("#post_ID").val(),visibility_groups:this.groups_modified};c.post(ajaxurl,a,this.saveGroupResponse)},saveGroupResponse:function(){e.app.getCurrentGroups(),e.app.showCurrentList(),e.app.clearCurrentList(),e.app.clearSearchList(),e.app.$("#visibility-search-term").val("")},toggleOverlay:function(){var a=c(".visibility-group-overlay");a.hasClass("visibility-group-overlay-open")?a.removeClass("visibility-group-overlay-open"):a.addClass("visibility-group-overlay-open")},toggleMemberList:function(a){var b=c(a.target);if(!b.is(".visibility-group-select")){b.is(".visibility-group-single")||(b=b.parents(".visibility-group-single"));var d=b.find(".visibility-group-members");d.hasClass("visibility-group-members-open")?d.removeClass("visibility-group-members-open"):d.addClass("visibility-group-members-open")}},toggleGroupSelection:function(a){var b=c(a.target),e=b.data("group-id");c.inArray(e,this.groups_modified)>-1?(this.groups_modified=d.without(this.groups_modified,e),b.removeClass("visibility-group-selected")):(this.groups_modified.push(e),b.addClass("visibility-group-selected"))},clearSearchList:function(){this.$("#visibility-find-group-list .visibility-group-results").html("")},clearCurrentList:function(){this.$("#visibility-current-group-list .visibility-group-results").html("")},showSearchList:function(){c("#visibility-find-group-list").hasClass("visibility-group-list-open")?this.clearSearchList():this.toggleLists()},showCurrentList:function(){var a=c("#visibility-current-group-list"),b=c("#visibility-find-group-list");b.hasClass("visibility-group-list-open")&&(b.removeClass("visibility-group-list-open"),b.find(".visibility-group-tab").removeClass("visibility-current-tab"),a.addClass("visibility-group-list-open"),a.find(".visibility-group-tab").addClass("visibility-current-tab"))},toggleLists:function(){c(".visibility-group-list").each(function(){c(this).hasClass("visibility-group-list-open")?(c(this).removeClass("visibility-group-list-open"),c(this).find(".visibility-group-tab").removeClass("visibility-current-tab")):(c(this).addClass("visibility-group-list-open"),c(this).find(".visibility-group-tab").addClass("visibility-current-tab"))})},closeGroups:function(){this.toggleOverlay(),this.clearSearchList(),this.clearCurrentList(),this.$("#visibility-search-term").val("")}})}(window,Backbone,jQuery,_,wsuContentVisibility);var wsuContentVisibility=wsuContentVisibility||{};!function(a,b,c,d,e){"use strict";e.group=b.Model.extend({"default":{groupID:"",groupName:"",memberCount:0,memberList:"",selectedClass:""}}),e.group.prototype.sync=function(){return null},e.group.prototype.fetch=function(){return null},e.group.prototype.save=function(){return null}}(window,Backbone,jQuery,_,wsuContentVisibility);var wsuContentVisibility=wsuContentVisibility||{};!function(a,b){b.app=new b.appView}(window,wsuContentVisibility);