var wsuContentVisibility=wsuContentVisibility||{};!function(a,b,c,d,e){"use strict";e.groupView=b.View.extend({template:d.template(c("#ad-group-template").html()),render:function(){return this.$el.html(this.template(this.model.attributes)),this}})}(window,Backbone,jQuery,_,wsuContentVisibility);var wsuContentVisibility=wsuContentVisibility||{};!function(a,b,c,d,e){"use strict";e.appView=b.View.extend({el:"#wsuwp-sso-ad-group",events:{"click #wsu-group-manage":"openGroupModal","click #wsu-group-search":"searchGroups","click #wsu-save-groups":"saveGroups","click #wsu-cancel-groups":"cancelGroupSearch","click .ad-group-overlay-close":"closeGroups","click .ad-group-single":"toggleMemberList","click .ad-group-select":"toggleGroupSelection"},groups:[],groups_modified:[],initialize:function(){this.groups=c.map(a.wsuADGroups,function(a){return a}),this.groups_modified=this.groups},addOne:function(a,b){var d=new wsuADVisibility.groupView({model:a});c("#ad-"+b+"-group-list").find(".ad-group-results").append(d.render().el)},openGroupModal:function(a){a.preventDefault(),this.getCurrentGroups(),this.toggleOverlay()},getCurrentGroups:function(){var a,b={action:"wsuwp_get_ad_groups",_ajax_nonce:wsuADGroups_nonce,post_id:c("#post_ID").val()};c.post(ajaxurl,b,function(b){if(b.success===!1);else{var d=[];a=c.parseJSON(b),c(a).each(function(b){var c=new wsuADVisibility.group({groupID:a[b].dn,groupName:a[b].display_name,memberCount:a[b].member_count,memberList:a[b].member,selectedClass:a[b].selected_class});d.push(a[b].dn),wsuADVisibility.app.addOne(c,"current")}),this.groups=d}})},searchGroups:function(a){a.preventDefault(),this.showSearchList();var b,d={action:"wsuwp_ad_group_check",_ajax_nonce:wsuADGroups_nonce,post_id:c("#post_ID").val(),ad_group:c("#wsu-group-visibility").val()};c.post(ajaxurl,d,function(a){a.success===!1||(b=c.parseJSON(a),c(b).each(function(a){var c=new wsuADVisibility.group({groupID:b[a].dn,groupName:b[a].display_name,memberCount:b[a].member_count,memberList:b[a].member,selectedClass:b[a].selected_class});e.app.addOne(c,"find")}))})},cancelGroupSearch:function(a){a.preventDefault(),this.groups_modified=this.groups,this.clearCurrentList(),this.getCurrentGroups(),this.showCurrentList(),this.clearSearchList(),this.$("#wsu-group-visibility").val("")},saveGroups:function(a){a.preventDefault();var b={action:"wsuwp_ad_group_save",_ajax_nonce:wsuADGroups_nonce,post_id:c("#post_ID").val(),ad_groups:this.groups_modified};c.post(ajaxurl,b,this.saveGroupResponse)},saveGroupResponse:function(a){wsuADVisibility.app.getCurrentGroups(),wsuADVisibility.app.showCurrentList(),wsuADVisibility.app.clearCurrentList(),wsuADVisibility.app.clearSearchList(),wsuADVisibility.app.$("#wsu-group-visibility").val("")},toggleOverlay:function(){var a=c(".ad-group-overlay");a.hasClass("ad-group-overlay-open")?a.removeClass("ad-group-overlay-open"):a.addClass("ad-group-overlay-open")},toggleMemberList:function(a){var b=c(a.target);if(!b.is(".ad-group-select")){b.is(".ad-group-single")||(b=b.parents(".ad-group-single"));var d=b.find(".ad-group-members");d.hasClass("ad-group-members-open")?d.removeClass("ad-group-members-open"):d.addClass("ad-group-members-open")}},toggleGroupSelection:function(a){var b=c(a.target),e=b.data("group-id");c.inArray(e,this.groups_modified)>-1?(this.groups_modified=d.without(this.groups_modified,e),b.removeClass("ad-group-selected")):(this.groups_modified.push(e),b.addClass("ad-group-selected"))},clearSearchList:function(){this.$("#ad-find-group-list .ad-group-results").html("")},clearCurrentList:function(){this.$("#ad-current-group-list .ad-group-results").html("")},showSearchList:function(){c("#ad-find-group-list").hasClass("ad-group-list-open")?this.clearSearchList():this.toggleLists()},showCurrentList:function(){var a=c("#ad-current-group-list"),b=c("#ad-find-group-list");b.hasClass("ad-group-list-open")&&(b.removeClass("ad-group-list-open"),b.find(".ad-group-tab").removeClass("ad-current-tab"),a.addClass("ad-group-list-open"),a.find(".ad-group-tab").addClass("ad-current-tab"))},toggleLists:function(){c(".ad-group-list").each(function(){c(this).hasClass("ad-group-list-open")?(c(this).removeClass("ad-group-list-open"),c(this).find(".ad-group-tab").removeClass("ad-current-tab")):(c(this).addClass("ad-group-list-open"),c(this).find(".ad-group-tab").addClass("ad-current-tab"))})},closeGroups:function(){this.toggleOverlay(),this.clearSearchList(),this.clearCurrentList(),this.$("#wsu-group-visibility").val("")}})}(window,Backbone,jQuery,_,wsuContentVisibility);var wsuContentVisibility=wsuContentVisibility||{};!function(a,b,c,d,e){"use strict";e.group=b.Model.extend({"default":{groupID:"",groupName:"",memberCount:0,memberList:"",selectedClass:""}}),e.group.prototype.sync=function(){return null},e.group.prototype.fetch=function(){return null},e.group.prototype.save=function(){return null}}(window,Backbone,jQuery,_,wsuContentVisibility);var wsuContentVisibility=wsuContentVisibility||{};!function(a,b){b.app=new b.appView}(window,wsuContentVisibility);